<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <title>Makeup | Inventory System</title>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">

        <style>
            * {
              font-family: "Poppins", sans-serif;
            }
            body {
                font-size: 15px;
            }
            h1 {
              font-weight: bold;
            }
            table {
              table-layout: fixed;
              width: 100%;
            }
            th,
            td {
              overflow: hidden;
              text-overflow: ellipsis;
              white-space: nowrap;
            }
            td.description {
              white-space: normal;
              word-wrap: break-word;
            }
          </style>
          

    </head>

    <body class="bg-light">
        <div class="container mt-5">
            <h1 class="text-center mb-4">Makeup Inventory System</h1>
            <a href="/makeups/new" class="btn btn-primary mb-4">Add Makeup</a>

            <table class="table table-striped table-bordered">
                <thead class="thead-dark">
                    <tr>
                        <th style="width: 5%;">#</th>
                        <th style="width: 25%;">Name</th>
                        <th style="width: 10%;">Category</th>
                        <th style="width: 10%;">Quantity</th>
                        <th style="width: 10%;">Price</th>
                        <th style="width: 30%;">Description</th>
                        <th style="width: 15%;">Created At</th>
                        <th style="width: 28%;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% makeups.forEach((makeup, index) => { %>
                        <tr>
                            <td><%= index + 1 %></td>
                            <td><%= makeup.name %></td>
                            <td><%= makeup.category %></td>
                            <td><%= makeup.quantity %></td>
                            <td>Php <%= makeup.price %></td>
                            <td><%= makeup.description %></td>
                            <td><%= new Date(makeup.createdAt).toLocaleDateString() %></td>
                            <td>
                                <a href="/makeups/<%= makeup._id %>" class="btn btn-info btn-sm">View</a>
                                <a href="/makeups/<%= makeup._id %>/edit" class="btn btn-warning btn-sm">Edit</a>
                                <button class="btn btn-danger btn-sm" onclick="confirmDelete('<%= makeup._id %>')">Delete</button>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>

        <!-- Delete Confirmation Modal -->
        <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        Are you sure you want to delete this product?
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-danger" id="confirmDeleteButton">Delete</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Success Modal -->
        <div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="successModalLabel">Success</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="successMessage"></div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            function confirmDelete(makeupId) {
                const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
                document.getElementById('confirmDeleteButton').onclick = function() {
                    window.location.href = `/makeups/${makeupId}/delete?_method=DELETE`;
                };
                deleteModal.show();
            }

            // Show success modal if redirected with a message
            <% if (typeof successMessage !== 'undefined') { %>
                const successModal = new bootstrap.Modal(document.getElementById('successModal'));
                document.getElementById('successMessage').innerText = "<%= successMessage %>";
                successModal.show();
            <% } %>
        </script>
    </body>
</html>